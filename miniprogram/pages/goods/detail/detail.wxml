<scroll-view scroll-y class="container">
  <!-- 顶部发布者信息 -->
  <view class="header">
    <image class="avatar" src="{{publisherInfo.avatar}}" />
    <view class="user-info">
      <text class="nickname">{{publisherInfo.nickname}}</text>
      <text class="meta">{{goodsItem.formattedTime}} · {{publisherInfo.location}}</text>
    </view>
  </view>

  <!-- 商品图片轮播 -->
  <swiper class="swiper" indicator-dots>
    <swiper-item wx:for="{{goodsItem.images}}" wx:key="*this">
      <image src="{{item}}" mode="widthFix" class="product-image" />
    </swiper-item>
  </swiper>

  <!-- 商品详情 -->
  <view class="detail-section">
    <view class="price-row">
      <text class="price">¥{{goodsItem.marketPrice}}</text>
      <text class="original-price" wx:if="{{goodsItem.originalPrice}}">¥{{goodsItem.originalPrice}}</text>
    </view>
    <text class="title">{{goodsItem.name}}</text>
    <view class="stats">
      <text>{{goodsItem.wishCount}}人想要</text>
      <text>{{goodsItem.viewCount}}浏览</text>
    </view>
    <view class="specs">
      <!-- 规格部分，可根据需要添加 -->
    </view>
    <view class="description">
      {{goodsItem.description}}
    </view>
  </view>

  <!-- 留言模块 -->
  <view class="message-module">
    <!-- 留言输入区域 -->
    <view class="message-input-section">
      <input class="message-input" placeholder="写下您的留言" value="{{newMessage}}" bindinput="handleMessageInput" />
      <button class="send-btn" bindtap="sendMessage">发送</button>
    </view>

    <!-- 留言列表（初始显示3条） -->
    <view class="message-list">
      <block wx:for="{{displayMessages}}" wx:key="id">
        <view class="message-item">
          <text class="message-content">{{item.content}}</text>
          <text class="message-time">{{formatTime(item.timestamp)}}</text>
        </view>
      </block>
    </view>

    <!-- 查看全部留言按钮 -->
    <view class="view-all" bindtap="showAllMessages">
      <text>查看全部留言</text>
    </view>
  </view>
</scroll-view>

<!-- 底部固定工具栏 -->
<view class="toolbar">
  <button class="btn favorite" bindtap="toggleFavorite">
    <image src="{{isFavorite ? '/assets/images/fav-filled.png' : '/assets/images/fav-empty.png'}}" />
    <text>收藏</text>
  </button>
  <button class="btn share" open-type="share">
    <image src="/assets/images/wechat.png" />
    <text>分享</text>
  </button>
  <button class="btn want" bindtap="navigateToMessage">
    <image src="/assets/images/message.png" />
    <text>我想要</text>
  </button>
</view>

<!-- 全部留言弹窗 -->
<view class="all-messages-popup" wx:if="{{showAllMessagesPopup}}">
  <view class="popup-overlay" bindtap="closeMessagesPopup"></view>
  <view class="popup-content">
    <view class="popup-header">
      <text>全部留言</text>
      <image class="close-icon" src="/assets/images/close.png" bindtap="closeMessagesPopup" />
    </view>
    <scroll-view scroll-y class="popup-scroll">
      <block wx:for="{{messages}}" wx:key="id">
        <view class="popup-message-item">
          <text>{{item.content}}</text>
          <text class="popup-message-time">{{formatTime(item.timestamp)}}</text>
        </view>
      </block>
    </scroll-view>
  </view>
</view>
